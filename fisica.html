<!DOCTYPE html>
<html lang="pt-br">

<head>
  <!-- =========================
       META / CONFIGURAÃ‡Ã•ES
  ========================== -->
  <meta charset="UTF-8">
  <title>Portal do Professor Arlisson â€¢ FÃ­sica</title>

    <!-- Estilo global do portal -->
<link rel="stylesheet" href="css/style.css">

<!-- Estilo especÃ­fico do mÃ³dulo FÃ­sica -->
<link rel="stylesheet" href="css/fisica.css">
</head>

<!-- 
  data-theme controla o modo claro/escuro
-->
<body data-theme="light">

<!-- =========================
     HEADER / HUD SUPERIOR
========================== -->
<header class="header">

  <!-- MINI HUD DO USUÃRIO -->
  <div class="mini-hud">

    <img
      id="patente-img"
      class="mini-patente"
      src=""
      alt="Patente do usuÃ¡rio"
    />

    <div class="mini-xp">
      <div id="xp-preenchimento"></div>
    </div>

    <div class="mini-detalhes">

      <img
        id="patente-img-detalhe"
        class="patente-grande"
        src=""
        alt="Patente detalhada"
      />

      <div class="info-texto">
        <strong>NÃ­vel <span id="nivel-usuario">0</span></strong>
        <span id="xp-texto">XP 0 / 100</span>
      </div>

    </div>
  </div>

  <!-- TÃTULO CENTRAL -->
  <div class="header-centro">
    <h1 class="portal-title">
      <span class="portal-brand">Portal</span>
      <span class="portal-name">Professor Arlisson</span>
    </h1>
    <p>Materiais de FÃ­sica e MatemÃ¡tica â€¢ Ensino MÃ©dio e EJA (2026)</p>
  </div>

  <!-- AÃ‡Ã•ES -->
  <div class="header-direita">
    <div class="header-botoes">
      <button id="toggle-tema" title="Alternar tema">ðŸŒ™</button>
      <button onclick="sair()">Sair</button>
    </div>
  </div>

</header>

<!-- =========================
     CONTEÃšDO PRINCIPAL
========================== -->
<main data-modulo="fisica">

  <!-- TÃTULO DO MÃ“DULO -->
  <section class="welcome-user">
    <h2>
      ðŸ“˜ FÃ­sica â€”
      <span id="nome-usuario">Aluno</span>, bora aprender? âš¡
    </h2>
  </section>

  <!-- AQUI ENTRARÃƒO:
       â€¢ ConteÃºdos
       â€¢ Listas
       â€¢ VÃ­deos
       â€¢ PDFs
       â€¢ ExercÃ­cios
  -->

  <section class="trilhas">
  <h3>ðŸ“š Trilhas de Aprendizagem</h3>

  <!-- Aqui o JS vai inserir os cards -->
  <div id="lista-trilhas" class="cards-trilhas"></div>
</section>


</main>

<!-- =========================
     SCRIPT: LOGOUT
========================== -->
<script>
function sair() {
  localStorage.clear();

  if (window.firebase && firebase.auth) {
    firebase.auth().signOut().finally(() => {
      window.location.href = "index.html";
    });
  } else {
    window.location.href = "index.html";
  }
}
</script>

<!-- =========================
     SCRIPTS DO SISTEMA
========================== -->
<script type="module" src="js/auth-guard.js"></script>
<script type="module" src="js/perfil.js"></script>
<script src="js/tema.js"></script>
<script type="module" src="js/hud.js"></script>
<script src="js/gamificacao.js"></script>
<!-- JS ESPECÃFICO DA FÃSICA -->
<script type="module" src="js/fisica.js"></script>


<!-- =========================
     LEVEL UP OVERLAY
========================== -->
<div id="levelup-overlay">
  <div class="levelup-box">
    <div class="levelup-title">LEVEL UP</div>
    <div class="levelup-level">
      NÃ­vel <span id="levelup-nivel">0</span>
    </div>
  </div>
</div>


<script type="module">
  import { getAuth, onAuthStateChanged } 
    from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";

  import { 
    getFirestore, 
    doc, 
    updateDoc, 
    increment 
  } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

  import { app } from "./js/firebase.js";

  const auth = getAuth(app);
  const db   = getFirestore(app);

  onAuthStateChanged(auth, async (user) => {
    if (!user) return;

    const raw = localStorage.getItem("checkpointConcluido");
    if (!raw) return;

    const evento = JSON.parse(raw);

    if (!evento.trilha || !evento.xp) return;

    const userRef = doc(db, "usuarios", user.uid);

    // ðŸ”¥ XP REAL (Firestore)
    await updateDoc(userRef, {
      xp: increment(evento.xp)
    });

    // ðŸ”¥ XP VISUAL
    if (window.adicionarXPVisual) {
      window.adicionarXPVisual(evento.xp);
    }

    // ðŸ§¹ Anti-duplicaÃ§Ã£o
    localStorage.removeItem("checkpointConcluido");
  });
</script>
</body>
</html>
